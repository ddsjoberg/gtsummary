on: push

name: Continuous Benchmarks GTS

jobs:
  build:
    runs-on: macOS-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@master

      - name: Create required directories
        run: |
          cd /Users/runner/work/gtsummary/gtsummary/benchmark
          mkdir lib
          cd lib
          mkdir cran
          cd /Users/runner/work/gtsummary/gtsummary/benchmark/lib
          mkdir github
          cd /Users/runner/work/gtsummary/gtsummary/benchmark/lib
          ls

      - name: Setup R
        uses: r-lib/actions/setup-r@master

      - name: Install dependencies
        run: |
          Rscript -e "install.packages(c('remotes'))"
          # Rscript -e "remotes::install_deps(dependencies = TRUE)"
          # Rscript -e "remotes::install_github('r-lib/bench')"
          # R CMD INSTALL .

      - name: Install Pandoc
        uses: r-lib/actions/setup-pandoc@9598b8eeb6d88de7d76d580d84443542bbfdffce
        with:
          pandoc-version: 2.11.1.1

      - name: Run BM Script
        run: |
          source("benchmark/benchmark_gts.R")
        shell: Rscript {0}

      # - name: Build RMD REPORT
      #   run: |
      #     git checkout benchmark3
      #     # Rscript -e 'bench::cb_fetch(); stored_benchmarks <- bench::cb_read(here::here("bench")); rmarkdown::render(input = here::here("bench/benchmark2html.Rmd"), output_file = here::here("bench/benchmark2html.html"),  clean = T, params = list(stored_benchmarks = stored_benchmarks))'
      #     Rscript -e 'bench::cb_fetch(); stored_benchmarks <- bench::cb_read(); rmarkdown::render(input = here::here("bench/benchmark2html.Rmd"), output_file = here::here("bench/benchmark2html.html"),  clean = T, params = list(stored_benchmarks = stored_benchmarks))'
      - name: Commit files
        run: |
          git config --global user.email "ghau@example.com"
          git config --global user.name "GitHub Actions User"
          git add /Users/runner/work/gtsummary/gtsummary/benchmark/benchmark.csv
          git add /Users/runner/work/gtsummary/gtsummary/benchmark/benchmark.png
          git add /Users/runner/work/gtsummary/gtsummary/benchmark/benchmark_jitter.png
          git commit -am "continous benchmark autocommit"
          git push
